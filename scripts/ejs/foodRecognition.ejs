<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Homepage</title>
    <link rel="stylesheet" href="/../css/common.css" type="text/css">
    <link rel="stylesheet" href="/../css/foodRecognition.css" type="text/css">
    <link rel="stylesheet" href="/../css/oppositeHeader.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"> </script>
  </head>
  <body>

  <header class="header">
      <a href="home.ejs" class="logo">
          <img></a>
      <nav>
          <ul>
              <li><a href="contact.ejs">Contact</a></li>
              <li><a href="aboutUs.ejs">About Us</a></li>
          </ul>
      </nav>
  </header>

  <div class="video-title">
    <h1 id="page-title-Food-Recognition">Food Recognition</h1>
  </div>


  <video width="100%" height="auto" autoplay loop muted webkit-playesinline>
      <source src="../media/FoodRecognition-Header-video.mp4" type="video/mp4">
      Your browser does not support the video tag.
  </video>


  <br><br><br><br>
  <section class="para">
    <h1>How it Works</h1>
    <p>With the use of recognition based AI softwares and database, our food recognition tool is able to determine how much food waste is present in the image based on factors set by our developers</p>
  </section>
  <br><br>
  <section id="section">
    <div>
        <video id="cameraVid" class="same-sizes"></video>
        <div>
          <button class="button" onClick="openCamera()">Turn on camera</button>
          <button class="button" onClick="closeCamera()">Turn off camera</button>
          <button class="button" id="analyze-btn" onClick="takePic();"> Analyze image </button>
        </div>
        
        <form id="form" action="/image" method="POST">
          <input type="hidden" id="img-data" name="img_data">
        </form>
        <canvas id="canvas" class="same-sizes"></canvas>
        <img style="visibility: hidden" src="" id="helper">
      </div>

      <section>
        <div id="results">
        </div>
      </section>
  </section>
      
  <script src="../js/foodRecognition.js" type="text/javascript"></script>
  <script src="../js/common.js" type="text/javascript"></script>
  <% if (hasData) { %>
    <script>
      let d = JSON.parse('<%= JSON.stringify(imageClassData) %>'.replace(/&#34;/g,'"'));
      let bb = JSON.parse('<%= JSON.stringify(bb) %>'.replace(/&#34;/g,'"'))[0];
      var z = 0;
      var z_classname;
      d.forEach(x => {
        if (x.probability > 0.6 && x.probability > z){
          z = x.probability;
          z_classname = x.className;
        }
      });
      $("<span>"+z_classname.replace('_', '<i style="visibility: hidden;">_</i>')+"</span><br>").appendTo($("#results"));
      $("#helper").attr('src', "data:image/png;base64,"+JSON.parse(window.localStorage[KEY]));
      document.querySelector("#helper").onload = function() {
        canvas.width = 423;
        canvas.height = 284;
        let ctx = canvas.getContext('2d');
        ctx.drawImage($("#helper")[0], 0, 0);
        ctx.beginPath();
        ctx.rect(bb[1], bb[0], bb[3]-bb[1], bb[2]-bb[0]);
        ctx.stroke();
        $("#canvas").show();
        $("#canvas").css("display", "block");
      }
    </script>
  <% } %>
</body>
</html>
